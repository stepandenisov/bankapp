<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Корзина товаров</title>
    <script language="JavaScript">
        setInterval(() => {
            var td = document.getElementById('exchange_rates');
            fetch('http://localhost:8080/exchange/rate',{
                method: 'GET',
                mode: 'cors'
            })
                .then(response => response.json())
                .then(json => json.rate)
                .then(json => {
                    var table = '<table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">';
                    table += '<tr><th colspan="3">Курсы валют по отношению к рублю</th></tr>';
                    table += '<tr><th>Валюта</th><th>Курс</th></tr>';
                    json.forEach(rate => {
                        table += '<tr>';
                        table += '<td>' + rate.currency + '</td>';
                        table += '<td>' + rate.value + '</td>';
                        table += '</tr>';
                    });
                    table += '</table>';
                    td.innerHTML = table;
                })
                .catch(error => td.innerHTML = error);
        }, 1000);
    </script>
</head>

<body>
<a href="/signup" style="float:right;">
    <b>РЕГИСТРАЦИЯ &plus;</b>
</a>
<br>
<a href="/logout" style="float:right;">
    <b>ВЫЙТИ &cudarrr;</b>
</a>
<table style="width:70%;margin-left:auto;margin-right:auto;">
    <tr>
        <td style="padding:2px;">
            <form method="post" th:action="${'/user/password'}" enctype="multipart/form-data">
                <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                    <tr>
                        <td style="font-weight:bold;">Логин</td>
                        <!--                <td colspan="2" th:text="${login}"/>-->
                    </tr>
                    <tr>
                        <td style="font-weight:bold;">Изменить пароль</td>
                        <td>
                            <p style="color:red;" th:if="${passwordErrors!=null}"
                               th:each="passwordError : ${passwordErrors}" th:text="${passwordError}"/>
                            <p>
                                Пароль: <input name="password" type="password" required/>
                            </p>
                            <p>
                                Повторите пароль: <input name="confirmPassword" type="password" required/>
                            </p>
                        </td>
                        <td style="text-align:right">
                            <button>Изменить пароль</button>
                        </td>
                    </tr>
                </table>
            </form>
        </td>
    <tr>
        <td style="padding:2px;">
            <form method="post" th:action="${'/user/info'}" enctype="multipart/form-data">
                <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                    <tr th:if="${userAccountsErrors!=null}" th:each="userAccountsError : ${userAccountsErrors}">
                        <td style="color:red;" th:text="${userAccountsError}"/>
                    </tr>
                    <tr>
                        <td style="font-weight:bold;">Фамилия Имя</td>
                        <td th:text="${name}"/>
                        <td>
                            <input name="name" type="text" style="width:100%"/>
                        </td>
                    </tr>
                    <tr>
                        <td style="font-weight:bold;">Дата рождения</td>
                        <td th:text="${birthday}"/>
                        <td>
                            <input name="birthday" type="date" style="width:100%"/>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:right" colspan="3">
                            <button>Сохранить изменения</button>
                        </td>
                    </tr>
                </table>
            </form>
        </td>
    </tr>
    <tr>
        <td style="padding:2px;">
            <table style="width:100%; background-color: #f9f9f9; padding: 10px; border-radius: 5px;">
                <tr th:each="account : ${accounts}">
                    <td style="font-weight:bold;" th:text="${account.getCurrency().name()}"></td>
                    <td th:text="${account.getReminder() + ' ' + account.getCurrency().name()}"></td>
                    <td style="text-align:right">
                        <form th:action="@{'/accounts/' + ${account.getId()} + '/delete'}" method="post"
                              th:object="${account}">
                            <button type="submit" onclick="return confirm('Удалить счет?')">Удалить</button>
                        </form>
                    </td>
                </tr>
            </table>
            <form method="post" th:action="@{/accounts}" enctype="multipart/form-data">
                <table style="width:100%; background-color: #f9f9f9; padding: 10px; border-radius: 5px;">
                    <tr>
                        <td style="font-weight:bold;">Добавить счет</td>
                        <td>
                            <select name="currency" required>
                                <option value="" disabled selected>Выберите валюту</option>
                                <option th:each="eachCurrency : ${availableCurrencies}"
                                        th:value="${eachCurrency.name()}"
                                        th:text="${eachCurrency.name()}">
                                </option>
                            </select>
                        </td>
                        <td style="text-align:right">
                            <button type="submit">Добавить</button>
                        </td>
                    </tr>
                </table>
            </form>
        </td>
    </tr>
    <tr>
        <td style="padding:2px;">
            <form method="post" th:action="${'/user/cash'}">
                <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                    <tr th:if="${cashErrors!=null}" th:each="cashError : ${cashErrors}">
                        <td style="color:red;" th:text="${cashError}"/>
                    </tr>
                    <tr>
                        <td style="font-weight:bold;">Наличные</td>
                        <td>
                            Валюта
                            <select name="currency">
                                <option th:each="eachCurrency : ${userCurrency}" th:value="${eachCurrency.name()}"
                                        th:text="${eachCurrency.name()}"/>
                            </select>
                        </td>
                        <td>
                            <input name="value" type="number" style="width:100%" required/>
                        </td>
                        <td>
                        <td style="text-align:right">
                            <button name="action" value="PUT">Положить</button>
                            <button name="action" value="GET">Снять</button>
                        </td>
                    </tr>
                </table>
            </form>
        </td>
    </tr>
    <tr>
        <td style="padding:2px;">
            <form method="post" th:action="${'/transfer/self'}" enctype="multipart/form-data">
                <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                    <tr th:if="${transferErrors!=null}" th:each="transferError : ${transferErrors}">
                        <td style="color:red;" th:text="${transferError}"/>
                    </tr>
                    <tr>
                        <td style="font-weight:bold;">Перевод себе</td>
                        <td>
                            Со счета
                            <select name="fromAccountId">
                                <option th:each="account : ${accounts}" th:value="${account.getId()}"
                                        th:text="${account.getCurrency().name()}"/>
                            </select>
                        </td>
                        <td>
                            На счет
                            <select name="toAccountId">
                                <option th:each="account : ${accounts}" th:value="${account.getId()}"
                                        th:text="${account.getCurrency().name()}"/>
                            </select>
                        </td>
                        <td>
                            <input name="amount" type="number" style="width:100%" required/>
                        </td>
                        <td style="text-align:right">
                            <button>Перевести</button>
                        </td>
                    </tr>
                </table>
            </form>
        </td>
    </tr>
    <tr>
        <td style="padding:2px;">
            <form method="post" th:action="${'/transfer/external'}">
                <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                    <tr th:if="${transferOtherErrors!=null}" th:each="transferOtherError : ${transferOtherErrors}">
                        <td style="color:red;" th:text="${transferOtherError}"/>
                    </tr>
                    <tr>
                        <td style="font-weight:bold;">Перевод другому</td>
                        <td>
                            Со счета
                            <select name="fromAccountId">
                                <option th:each="account : ${accounts}" th:value="${account.getId()}"
                                        th:text="${account.getCurrency().name()}"/>
                            </select>
                        </td>
                        <td>
                            На счет
                            <select name="toCurrency">
                                <option th:each="eachCurrency : ${currency}" th:value="${eachCurrency.name()}"
                                        th:text="${eachCurrency.name()}"/>
                            </select>
                        </td>
                        <td>
                            <input name="amount" type="number" required/>
                        </td>
                        <td>
                            Кому
                            <select name="userId">
                                <option th:each="user : ${users}" th:value="${user.id()}"
                                        th:text="${user.fullName()}"/>
                            </select>
                        </td>
                        <td style="text-align:right">
                            <button>Перевести</button>
                        </td>
                    </tr>
                </table>
            </form>
        </td>
    </tr>
    <tr>
        <td style="padding:2px;" id="exchange_rates">
        </td>
    </tr>
</table>
</body>

</html>
